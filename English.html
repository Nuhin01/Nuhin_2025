<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinguaNet Cool - English Reading Analysis</title>
    <style>
        body {
            background: linear-gradient(180deg, #121212, #1e1e1e);
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        #chat-container {
            width: 800px;
            height: 90vh;
            background: rgba(0, 123, 255, 0.05);
            border: 2px solid #007bff;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 123, 255, 0.3), inset 0 0 10px rgba(0, 123, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        #chat-box {
            height: 65%;
            overflow-y: auto;
            padding: 10px;
            scrollbar-color: #007bff transparent;
            scrollbar-width: thin;
        }
        #chat-box::-webkit-scrollbar {
            width: 8px;
        }
        #chat-box::-webkit-scrollbar-track {
            background: transparent;
        }
        #chat-box::-webkit-scrollbar-thumb {
            background: #007bff;
            border-radius: 4px;
        }
        #input-passage {
            width: 100%;
            height: 15%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #007bff;
            color: #ffffff;
            font-size: 16px;
            border-radius: 10px;
            resize: none;
            transition: box-shadow 0.3s ease;
        }
        #input-passage:focus {
            box-shadow: 0 0 15px #007bff;
            outline: none;
        }
        #analyze-btn {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background: #007bff;
            color: #ffffff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background 0.2s ease;
        }
        #analyze-btn:hover {
            background: #0056b3;
        }
        #deep-analysis-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #17a2b8;
            color: #ffffff;
            padding: 10px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background 0.2s ease;
        }
        #deep-analysis-btn:hover {
            background: #138496;
        }
        .message {
            margin: 15px;
            padding: 12px;
            border-radius: 8px;
            animation: fadeIn 0.5s ease-in;
        }
        .user {
            background: rgba(0, 123, 255, 0.2);
            text-align: left;
        }
        .ai {
            background: rgba(255, 255, 255, 0.1);
            text-align: left;
            position: relative;
            white-space: pre-wrap; /* Preserve formatting for analysis */
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="chat-container">
        <div id="chat-box"></div>
        <textarea id="input-passage" placeholder="Enter your passage for linguistic analysis..."></textarea>
        <button id="analyze-btn">Analyze Passage</button>
        <button id="deep-analysis-btn">Deep Analysis</button>
    </div>
    <script>
        const chatBox = document.getElementById('chat-box');
        const inputPassage = document.getElementById('input-passage');
        const analyzeBtn = document.getElementById('analyze-btn');
        const deepAnalysisBtn = document.getElementById('deep-analysis-btn');
        let conversationHistory = [];
        const systemPrompt = `Analyze the provided passage by breaking it down sentence by sentence. For each sentence, first list all its clauses and specify the type of each clause (e.g., independent, dependent adverbial, relative, participial, etc.). Then, for every clause identified, break it down further by listing all its phrases and specifying the type of each phrase (e.g., noun phrase, verb phrase, prepositional phrase as adjectival or adverbial, participial phrase, gerundial phrase, etc.), including how it functions within the clause. Ensure your analysis is comprehensive, accurate, and handles complex structures like embedded clauses or modifiers intelligentlyâ€”cross-reference ambiguities if any, and use linguistic terminology precisely. If the passage is long, prioritize depth over brevity, and provide explanations for unusual constructions to enhance understanding. Format the output using Markdown: Use ## for main headings like Sentence 1, ### for subheadings like Clause Breakdown, - for lists, ** for bold text. Passage to analyze: [PASSAGE].`;

        // Function to convert Markdown-like text to HTML
        function markdownToHtml(text) {
            let html = '';
            const lines = text.split('\n');
            let inList = false;
            lines.forEach(line => {
                line = line.trim();
                if (line.startsWith('## ')) {
                    if (inList) {
                        html += '</ul>';
                        inList = false;
                    }
                    html += `<h2>${line.slice(3)}</h2>`;
                } else if (line.startsWith('### ')) {
                    if (inList) {
                        html += '</ul>';
                        inList = false;
                    }
                    html += `<h3>${line.slice(4)}</h3>`;
                } else if (line.startsWith('#### ')) {
                    if (inList) {
                        html += '</ul>';
                        inList = false;
                    }
                    html += `<h4>${line.slice(5)}</h4>`;
                } else if (line.startsWith('- ')) {
                    if (!inList) {
                        html += '<ul>';
                        inList = true;
                    }
                    let listItem = line.slice(2);
                    listItem = listItem.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    html += `<li>${listItem}</li>`;
                } else if (line) {
                    if (inList) {
                        html += '</ul>';
                        inList = false;
                    }
                    let paragraph = line.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    html += `<p>${paragraph}</p>`;
                } else {
                    if (inList) {
                        html += '</ul>';
                        inList = false;
                    }
                    html += '<br>';
                }
            });
            if (inList) {
                html += '</ul>';
            }
            return html;
        }

        // Add message to chat
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            if (sender === 'ai') {
                messageDiv.innerHTML = markdownToHtml(text); // Convert to structured HTML
            } else {
                messageDiv.textContent = text;
            }
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // Fetch AI response from Pollinations API
        async function fetchAIResponse(passage, deepAnalysis = false) {
            if (!passage.trim()) {
                addMessage('Error: No passage detected.', 'ai');
                return;
            }

            conversationHistory.push(`User Passage: ${passage}`);
            const prompt = deepAnalysis 
                ? systemPrompt.replace('[PASSAGE]', passage).replace('Format the output using Markdown', 'Perform a deep analysis and format the output using Markdown')
                : systemPrompt.replace('[PASSAGE]', passage);
            
            try {
                addMessage('Processing analysis...', 'ai');
                const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(prompt)}`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) {
                    throw new Error('API request failed');
                }
                
                const aiResponse = await response.text(); // Adjust if JSON
                if (!aiResponse || aiResponse.trim() === '') {
                    throw new Error('Empty response from API');
                }
                conversationHistory.push(`AI Analysis: ${aiResponse}`);
                trimConversationHistory();
                addMessage(aiResponse, 'ai');
            } catch (error) {
                console.error('Error fetching AI response:', error);
                addMessage('Error: Analysis offline. Try again.', 'ai');
            }
        }

        // Trim conversation history to avoid API limits
        function trimConversationHistory() {
            if (conversationHistory.length > 10) {
                conversationHistory = conversationHistory.slice(-10);
            }
        }

        // Analyze button click
        analyzeBtn.onclick = () => {
            const passage = inputPassage.value.trim();
            fetchAIResponse(passage);
        };

        // Deep Analysis mode
        deepAnalysisBtn.onclick = () => {
            const passage = inputPassage.value.trim();
            if (passage) {
                addMessage('Activating Deep Analysis Mode...', 'ai');
                setTimeout(() => fetchAIResponse(passage, true), 1000);
            } else {
                addMessage('Error: No passage detected for Deep Analysis.', 'ai');
            }
        };
    </script>
</body>
</html>
